# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

orbs: 
  heroku: circleci/heroku@1.2.6

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  release-workflow:
    jobs:
      - install-heroku
      - build
      - push-docker-image
      - release-docker-image

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  install-heroku:
    executor: heroku/default
    steps:
      - run:
          name: Install Heroku CLI (If not installed)
          command: |
            if [[ $(command -v heroku) == "" ]]; then
              curl https://cli-assets.heroku.com/install.sh | sh
            else
              echo "Heroku is already installed. No operation was performed."
            fi
  push-docker-image:
    executor: heroku/default
    steps:
      - run: |
          heroku container:login
          heroku container:push -a gozealous
  release-docker-image:
    executor: heroku/default
    steps:
      - run: |
          heroku container:login
           heroku container:release -a gozealous
  build:
    description: Push Docker Image
    executor: heroku/default
    steps:
      - checkout
